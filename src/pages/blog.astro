---
import { getCollection } from "astro:content";
import { format } from "date-fns";
import BaseLayout from "@layouts/Base.astro";
import Section from "@components/Section.astro";

const blogPostsData = await await getCollection("blog");
let blogPosts = blogPostsData.map((post) => {
  return {
    ...post,
    formattedDate: format(new Date(post.data.date), "do MMMM, yyyy"),
  };
});
let nonDraftPosts = blogPosts.filter((post) => !post.data.draft);
nonDraftPosts.sort(
  (a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf()
);
---

<BaseLayout title="Connor Dowson | Blog">
  <Section width="small">
    <div class="region flow">
      <h1>Blog</h1>

      <p>
        Random posts, mostly about web dev 👨‍💻, music 🎶, and anything else that
        I find interesting.
      </p>

      <ul class="flow flow-space-l">
        {
          nonDraftPosts.map(({ data, slug }) => (
            <li class="flow flow-space-xs">
              <h2>
                <a href={`/blog/${slug}`}>{data.title}</a>
              </h2>

              <time>{format(new Date(data.date), "do MMMM, yyyy")}</time>
              <p>{data.description}</p>
            </li>
          ))
        }
      </ul>
    </div>
  </Section>
</BaseLayout>
