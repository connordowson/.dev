---
import { getCollection } from "astro:content";
import { format } from "date-fns";
import BaseLayout from "@layouts/Base.astro";
import Section from "@components/Section.astro";

const blogPostsData = await await getCollection("blog");
let blogPosts = blogPostsData.map((post) => {
  return {
    ...post,
    formattedDate: format(new Date(post.data.date), "do MMMM, yyyy"),
  };
});
let nonDraftPosts = blogPosts.filter((post) => !post.data.draft);
nonDraftPosts.sort(
  (a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf()
);

const maxWidth = "3xl";
---

<BaseLayout title="Connor Dowson | Blog" maxWidth={maxWidth}>
  <Section class={`w-full max-w-${maxWidth} mt-24 md:px-4 mx-auto`}>
    <h1 class="dark:text-emerald-400 text-emerald-500">Blog</h1>

    <p>
      Random posts, mostly about web dev 👨‍💻, music 🎶, and anything else that I
      find interesting.
    </p>

    <ul>
      {
        nonDraftPosts.map(({ data, slug }) => (
          <li class="prose dark:prose-dark max-w-none mt-12">
            <h2>
              <a href={`/blog/${slug}`}>{data.title}</a>
            </h2>

            <time>{format(new Date(data.date), "do MMMM, yyyy")}</time>
            <p>{data.description}</p>
          </li>
        ))
      }
    </ul>
  </Section>
</BaseLayout>
