---
import { format } from "date-fns";

import BaseLayout from "@layouts/Base.astro";
import Section from "@components/Section.astro";

const posts = await Astro.glob("../pages/blog/*.md");
const nonDraftPosts = posts.filter((post) => !post.frontmatter.draft);
nonDraftPosts.sort(
  (a, b) =>
    new Date(b.frontmatter.date).valueOf() -
    new Date(a.frontmatter.date).valueOf()
);

const maxWidth = "3xl";
---

<BaseLayout title="Connor Dowson | Blog" maxWidth={maxWidth}>
  <Section class={`w-full max-w-${maxWidth} mt-24 md:px-4 mx-auto`}>
    <h1 class="dark:text-emerald-400 text-emerald-500">Blog</h1>

    <p>
      Random posts, mostly about web dev 👨‍💻, music 🎶, and anything else that I
      find interesting.
    </p>

    <ul>
      {
        nonDraftPosts.map(({ frontmatter, url }) => (
          <li class="prose dark:prose-dark max-w-none">
            <a href={url}>
              <h2>{frontmatter.title}</h2>
            </a>

            <time>{format(new Date(frontmatter.date), "do MMMM, yyyy")}</time>
            <p>{frontmatter.description}</p>
          </li>
        ))
      }
    </ul>
  </Section>
</BaseLayout>
