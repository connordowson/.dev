---
import { getCollection } from "astro:content";
import { format } from "date-fns";
import Section from "@components/Section.astro";

const blogPostsData = await await getCollection("blog");
let blogPosts = blogPostsData.map((post) => {
  return {
    ...post,
    formattedDate: format(new Date(post.data.date), "do MMMM, yyyy"),
  };
});
let nonDraftPosts = blogPosts.filter((post) => !post.data.draft);
nonDraftPosts.sort(
  (a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf()
);
nonDraftPosts = [...nonDraftPosts.slice(0, 3)];
---

<Section class="max-w-7xl rounded-xl" relative>
  <h2 class="dark:text-emerald-400 mb-4 text-emerald-500">Blog</h2>
  <p class="pb-4">
    Random posts, mostly about web dev 👨‍💻, music 🎶, and anything else that I
    find interesting. <a href="./blog">View all posts</a>.
  </p>

  <ul
    class="my-4 grid gap-6 grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3"
  >
    {
      nonDraftPosts.map(({ data, formattedDate, slug }) => {
        return (
          <li class="flex flex-col gap-4 border dark:bg-white/5 dark:border-white/5  bg-white/20 border-slate-800/10 p-4 rounded-xl backdrop-blur-sm shadow-sm">
            <a href={`/blog/${slug}`}>
              <h3 class="text-[1.322rem]">{data.title}</h3>
            </a>

            <div class="flex justify-between mt-auto text-sm">
              <time class="dark:bg-slate-300/5 border dark:border-slate-300/5 dark:text-slate-300 bg-slate-200 text-slate-600 py-1 px-2 rounded-md">
                {formattedDate}
              </time>
              <span class="dark:bg-slate-300/5 border dark:border-slate-300/5 dark:text-slate-300 bg-slate-200 text-slate-600 py-1 px-2 rounded-md">
                5 mins
              </span>
            </div>
          </li>
        );
      })
    }
  </ul>
  <!-- <p class="pt-4"><a href="./blog">View all posts</a></p> -->
</Section>

<style lang="scss">
  section {
    position: relative;
    overflow: hidden;

    // &::before {
    //   content: "";
    //   width: 100%;
    //   height: 140%;
    //   position: absolute;
    //   top: 50%;
    //   left: 50%;
    //   z-index: -1;
    //   transform: translate(-50%, -50%);
    //   background: radial-gradient(
    //     ellipse at top right,
    //     #00ff9936 0%,
    //     transparent 70%
    //   );
    // }
  }
</style>
